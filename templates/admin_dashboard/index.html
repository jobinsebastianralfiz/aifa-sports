{% extends 'admin_dashboard/base.html' %}

{% block page_title %}Dashboard{% endblock %}
{% block header_title %}{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="content-header">
    <div class="content-header-left">
        <h2>Dashboard</h2>
        <p class="text-muted">Welcome to AIFA Admin Dashboard</p>
    </div>
</div>

<!-- Main Stats Grid -->
<div class="stats-grid">
    <!-- Programs -->
    <div class="dashboard-stat-card">
        <div class="stat-header">
            <div class="stat-icon" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                </svg>
            </div>
        </div>
        <div class="stat-value">{{ total_programs }}</div>
        <div class="stat-label">Active Programs</div>
    </div>

    <!-- Batches -->
    <div class="dashboard-stat-card">
        <div class="stat-header">
            <div class="stat-icon" style="background: linear-gradient(135deg, #22c55e, #16a34a);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/>
                </svg>
            </div>
        </div>
        <div class="stat-value">{{ total_batches }}</div>
        <div class="stat-label">Active Batches</div>
    </div>

    <!-- Coaches -->
    <div class="dashboard-stat-card">
        <div class="stat-header">
            <div class="stat-icon" style="background: linear-gradient(135deg, #a855f7, #7c3aed);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
            </div>
        </div>
        <div class="stat-value">{{ total_coaches }}</div>
        <div class="stat-label">Active Coaches</div>
    </div>

    <!-- Upcoming Events -->
    <div class="dashboard-stat-card">
        <div class="stat-header">
            <div class="stat-icon" style="background: linear-gradient(135deg, #eab308, #ca8a04);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
            </div>
        </div>
        <div class="stat-value">{{ upcoming_events }}</div>
        <div class="stat-label">Upcoming Events</div>
    </div>
</div>

<!-- Secondary Stats -->
<div class="stats-grid">
    <!-- New Messages -->
    <div class="dashboard-stat-card">
        <div class="stat-header">
            <div class="stat-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <polyline points="22,6 12,13 2,6"/>
                </svg>
            </div>
            {% if new_messages > 0 %}
            <span class="badge badge-danger">{{ new_messages }} New</span>
            {% endif %}
        </div>
        <div class="stat-value">{{ new_messages }}</div>
        <div class="stat-label">New Messages</div>
    </div>

    <!-- New Inquiries -->
    <div class="dashboard-stat-card">
        <div class="stat-header">
            <div class="stat-icon" style="background: linear-gradient(135deg, #f97316, #ea580c);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
            </div>
            {% if new_inquiries > 0 %}
            <span class="badge badge-warning">{{ new_inquiries }} New</span>
            {% endif %}
        </div>
        <div class="stat-value">{{ new_inquiries }}</div>
        <div class="stat-label">New Inquiries</div>
    </div>

    <!-- Event Registrations -->
    <div class="dashboard-stat-card">
        <div class="stat-header">
            <div class="stat-icon" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 11l3 3L22 4"/>
                    <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
                </svg>
            </div>
        </div>
        <div class="stat-value">{{ total_registrations }}</div>
        <div class="stat-label">Event Registrations</div>
    </div>

    <!-- Published News -->
    <div class="dashboard-stat-card">
        <div class="stat-header">
            <div class="stat-icon" style="background: linear-gradient(135deg, #64748b, #475569);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                </svg>
            </div>
        </div>
        <div class="stat-value">{{ total_news }}</div>
        <div class="stat-label">Published News</div>
    </div>
</div>

<!-- Recent Activity Section -->
<div class="dashboard-grid">
    <!-- Recent Messages -->
    <div class="data-table-container">
        <div class="table-header">
            <h3>Recent Messages</h3>
            <a href="{% url 'admin_dashboard:messages:list' %}" class="btn btn-ghost btn-sm">View All</a>
        </div>
        <div class="activity-list" style="padding: var(--space-4);">
            {% for message in recent_messages %}
            <div class="activity-item">
                <div class="activity-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                        <polyline points="22,6 12,13 2,6"/>
                    </svg>
                </div>
                <div class="activity-content">
                    <div class="activity-title">{{ message.name }} - {{ message.subject|truncatewords:5 }}</div>
                    <div class="activity-time">{{ message.created_at|timesince }} ago</div>
                </div>
                {% if message.status == 'new' %}
                <span class="badge badge-info">New</span>
                {% endif %}
            </div>
            {% empty %}
            <div class="empty-state-small">
                <p>No recent messages</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Recent Inquiries -->
    <div class="data-table-container">
        <div class="table-header">
            <h3>Recent Inquiries</h3>
            <a href="{% url 'admin_dashboard:inquiries:list' %}" class="btn btn-ghost btn-sm">View All</a>
        </div>
        <div class="activity-list" style="padding: var(--space-4);">
            {% for inquiry in recent_inquiries %}
            <div class="activity-item">
                <div class="activity-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                </div>
                <div class="activity-content">
                    <div class="activity-title">{{ inquiry.student_name }}</div>
                    <div class="activity-time">{{ inquiry.program.name }} - {{ inquiry.created_at|timesince }} ago</div>
                </div>
                {% if inquiry.status == 'new' %}
                <span class="badge badge-warning">New</span>
                {% endif %}
            </div>
            {% empty %}
            <div class="empty-state-small">
                <p>No recent inquiries</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Recent Registrations Table -->
<div class="data-table-container" style="margin-top: var(--space-6);">
    <div class="table-header">
        <h3>Recent Event Registrations</h3>
    </div>
    <table class="data-table">
        <thead>
            <tr>
                <th>Event</th>
                <th>Status</th>
                <th>Registered</th>
            </tr>
        </thead>
        <tbody>
            {% for reg in recent_registrations %}
            <tr>
                <td>
                    <strong>{{ reg.event.title }}</strong>
                </td>
                <td>
                    <span class="badge {% if reg.status == 'pending' %}badge-warning{% elif reg.status == 'confirmed' %}badge-success{% elif reg.status == 'cancelled' %}badge-danger{% else %}badge-secondary{% endif %}">
                        {{ reg.get_status_display }}
                    </span>
                </td>
                <td class="text-muted">{{ reg.created_at|timesince }} ago</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="3" class="text-center text-muted" style="padding: var(--space-8);">
                    No recent registrations
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
